<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Page Title</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
  <script src="main.js"></script> -->
</head>

<body>
  <div id="box">
    <input id="input" placeholder="input">
  </div>
  <!-- <button onclick="sendSocketMsg()">send SocketMsg</button> -->
  <button id="btn2" onclick="refreshList()">refresh list</button>
  <button onclick="sendMsg()">SEND</button>
  <div id="onlieList"></div>
</body>
<script src="https://cdn.bootcss.com/socket.io/2.1.1/socket.io.js"></script>
<script src="./assets/js/jquery.min.js"></script>

<script>
  var baseUrl = 'http://localhost:3000';

  var onlineEl = document.getElementById("onlieList");
  var toId;
  function sendSocketMsg() {
    socket.emit('message', 'send new msg')
  }

  function tochat(event) {
    console.log(event);
    var {id} = event.target.dataset;
    if(!id) return;
    toId = id;
  }

 function sendMsg() {
   $.ajax({
     url:baseUrl + "/message/send",
     data:{
       content: $("#input").val(),
       toId:toId
     }
   })
  }

  function refreshList() {
    $.ajax({
      url: baseUrl + "/message/onLine",
      success: function (res) {
        var html = '';
        (res||[]).forEach(item => {
          html += `<li data-id=${item}>${item}</li>`;
        });
        onlineEl.innerHTML = `<ul onclick="tochat(event)">${html}</ul>`
      },
      error: function (err) {
        console.log(err);
      }
    });
  }
</script>

<script>
  var socket = io("ws://localhost:3001");
  var el = document.getElementById("box");
  console.log('socket', socket);
  socket.on('connect', function () {
    socket.emit('message', 11);
    socket.on(socket.id, function (data) {
      console.log('on msg single', data);
    }); //简单实现单-单通信

    socket.on('message', function (data) {
      console.log('on message', data);
    });

  })
</script>

<script>
    // var ws = new WebSocket("ws://localhost:3000");
    // console.log('ws',ws);
    // ws.onmessage(event=>{
    //   console.log('onmessage',event);
    // })

    // wx.onclose (event=>{
    //   console.log('onclose',event);
    // })

    // wx.onopen  (event=>{
    //   console.log('onclose',event);
    // })

    // wx.onerror(err=>{
    //   console.log('onerror',err);
    // })
</script>

</html>